<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>成绩统计</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="../layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="../layuiadmin/style/admin.css" media="all">
    <script src="../echarts/echart.js"></script>
</head>
<body>
<div class="layui-form">
    <label class="layui-form-label">考试名称</label>
    <div class="layui-input-inline">
        <select name="pid" id="paperSelectId">
            <option value="">---请选择考试名称---</option>
        </select>
    </div>
    <button class="layui-btn layuiadmin-btn-comm" onclick="fenxi()">成绩统计</button>
</div>
<div id="chartmain" style="width:700px; height: 500px; float: left"></div>
<div id="chartmain1" style="width:500px; height: 500px;float: left"></div>
<div id="chartmain2" style="width:600px; height: 600px;float: left"></div>


</body>
<script src="../layuiadmin/layui/layui.js"></script>
<script>
    layui.config({
        base: '../layuiadmin/' //静态资源所在路径
    }).extend({
        index: 'lib/index' //主入口模块
    }).use(['index', 'table', 'upload'], function () {
        var $ = layui.$
            , form = layui.form
        selectPaperName($, form)
    });

    function selectPaperName($, form) {
        $.ajax({
            url: "/examPaper/getAllPaper",
            type: "GET",
            success: function (list) {
                var role = document.getElementById("paperSelectId");
                if (list == null || list.length == 0) {
                    layer.alert("暂无考试可以分析")
                }
                for (var i = 0; i < list.length; i++) {
                    var option = document.createElement("option");    // 创建添加option属性
                    option.setAttribute("value", list[i].pid);                  // 给option的value添加值
                    option.innerText = list[i].name;             // 打印option对应的纯文本
                    role.appendChild(option);                          // 给select 添加option子标签
                    form.render('select');
                }
            }
        });
    }
</script>
<script src="../layuiadmin/layui/jquery.min.js">
</script>
<script>
    function fenxi() {
        var pid = $("#paperSelectId").val();
        var testName = $("#paperSelectId").find("option:selected").text()
        if (pid == "") {
            layer.msg("请选择考试名称");
            return;
        }
        var option = {
            title: {
                text: '分数分布分析',
                subtext: '各分段统计'
            },
            tooltip: {
                trigger: 'axis'
            },
            legend: {
                data: ['' + testName]
            },
            toolbox: {
                show: true,
                feature: {
                    mark: {show: true},
                    dataView: {show: true, readOnly: false},
                    magicType: {show: true, type: ['line', 'bar']},
                    restore: {show: true},
                    saveAsImage: {show: true}
                }
            },
            calculable: true,
            xAxis: [
                {
                    type: 'category',
                    data: ['0-10', '10-20', '20-30', '30-40', '40-50', '50-60',
                        '60-70', '70-80', '80-90', '90-100']
                }
            ],
            yAxis: [
                {
                    type: 'value'
                }
            ],
            series: [
                {
                    name: testName,
                    type: 'bar',
                    data: [],
                    markPoint: {
                        data: [
                            {type: 'max', name: '最大值'},
                           // {type: 'min', name: '最小值'}
                        ]
                    }/*,
                    markLine: {
                        data: [
                            {type: 'average', name: '平均值'}
                        ]
                    }*/
                }
            ]
        };


        var option1 = {
            title : {
                text: '及格率',
                subtext: '',
                x:'center'
            },
            tooltip : {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            legend: {
                orient : 'vertical',
                x : 'left',
                data:['不及格率','及格率']
            },
            toolbox: {
                show : true,
                feature : {
                    mark : {show: true},
                    dataView : {show: true, readOnly: false},
                    magicType : {
                        show: true,
                        type: ['pie', 'funnel'],
                        option: {
                            funnel: {
                                x: '25%',
                                width: '50%',
                                funnelAlign: 'left',
                                max: 1548
                            }
                        }
                    },
                    restore : {show: true},
                    saveAsImage : {show: true}
                }
            },
            calculable : true,
            series : [
                {
                    name:'及格率',
                    type:'pie',
                    radius : '55%',
                    center: ['50%', '60%'],
                    data:[
                        {value:0, name:'不及格率'},
                        {value:0, name:'及格率'}
                    ]
                }
            ]
        };
        var myChart = echarts.init(document.getElementById('chartmain'));
        var myChart1 = echarts.init(document.getElementById('chartmain1'));
        $.ajax({
            url: '/score/fenduan',
            data: {pid: pid},
            success: function (obj) {
                for (var p in obj) {//遍历json对象的每个key/value对,p为key
                    option.series[0].data.push(obj[p]);
                }
                option1.title.subtext = testName;
                option1.series[0].data[0].value=obj[10];
                option1.series[0].data[1].value=obj[11];
                myChart.setOption(option);
                myChart1.setOption(option1);
            }
        })

    }

</script>

</html>